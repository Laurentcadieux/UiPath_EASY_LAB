##  ************************** Install Ad, DNS and management tool  ************************************
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://raw.githubusercontent.com/Laurentcadieux/UiPath_EASY_LAB/main/L1_master_win_dc_sql.ps1'))"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "Set-ExecutionPolicy Unrestricted"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "Add-WindowsFeature AD-Domain-Services, DNS -IncludeManagementTools"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "[System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072; iex ((New-Object System.Net.WebClient).DownloadString('https://chocolatey.org/install.ps1'))"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "$ENV:PATH=$ENV:PATH;C:\ProgramData\chocolatey"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "C:\ProgramData\chocolatey\choco.exe install sql-server-2019 -y"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "C:\ProgramData\chocolatey\choco.exe install sql-server-management-studio -y"
az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "C:\ProgramData\chocolatey\choco.exe install putty.install --version=0.71 -y"
#az vm run-command invoke -g $resourceGroup -n "$vm-dcsql01s" --command-id RunPowerShellScript --scripts "Install-ADDSForest -CreateDnsDelegation:$false -DomainName "uipathlab.com" -DomainNetbiosName "uipathlab" -DatabasePath "c:\Windows\NTDS" -InstallDns:$true -LogPath "c:\Windows\NTDS" -NoRebootOnCompletion:$false -SysvolPath "c:\Windows\SYSVOL" -Force:$true  -DomainMode "WinThreshold" -ForestMode "WinThreshold""
